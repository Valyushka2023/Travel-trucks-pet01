import{a as T,u as j,d as _,f as O,k as b,r,i as S,j as l,c as J,l as $,m as k}from"./index-D-09zEmN.js";import{u as A,S as B,s as L}from"./ScrollToTopButton-BSK_mNQJ.js";import P from"./ContentReviews-z7ec00EZ.js";import"./Button-CZ9CVJcW.js";import"./useForm-BK_WCOp3.js";import"./v4-CmTdKEVZ.js";const h={};function H(){const d=T(),w=j(),{_id:a}=_(),o=O(),c=b(),[i,m]=r.useState(null),[y,p]=r.useState(!1),[g,n]=r.useState(null),[C,f]=r.useState(0),[R,v]=r.useState([]),{visible:x,scrollToTop:E}=A(300);r.useEffect(()=>{async function t(){var e;if(c!=null&&c.camper)m(c.camper),localStorage.setItem(`camper_${a}`,JSON.stringify(c.camper));else if((e=o==null?void 0:o.state)!=null&&e.camper)m(o.state.camper),localStorage.setItem(`camper_${a}`,JSON.stringify(o.state.camper));else{const u=localStorage.getItem(`camper_${a}`);if(u)m(JSON.parse(u));else if(a)try{p(!0);const s=await $({id:a});(s==null?void 0:s.length)>0?(m(s[0]),localStorage.setItem(`camper_${a}`,JSON.stringify(s[0]))):n("Camper not found.")}catch(s){n(s.message||"Error loading camper.")}finally{p(!1)}else n("Camper ID не вказаний.")}}t()},[a,c,o]),r.useEffect(()=>{if(i){const t=i.reviews||[];v(t),I(t),d(S(i))}},[i,d]);const I=t=>{if(!t||t.length===0){f(0);return}const e=t.reduce((u,s)=>u+s.reviewer_rating,0);f(e/t.length)},N=async t=>{try{p(!0),n(null);const e=await k({camperId:a,...t});e!=null&&e.camper?(m(e.camper),v(e.camper.reviews),f(e.camper.rating),d(S(e.camper)),localStorage.setItem(`camper_${a}`,JSON.stringify(e.camper)),w("/thank-you",{state:{camperId:a}})):n("Error adding review and updating data.")}catch(e){n(e.message||"Error sending feedback.")}finally{p(!1)}};return y?l.jsx(J,{type:"container"}):g?l.jsxs("div",{className:h.error,children:["Error: ",g]}):i?l.jsxs("div",{children:[l.jsx(P,{camper:i,activeTab:"reviews",averageRating:C,reviews:R,onReviewAdded:N}),l.jsx(B,{visible:x,onClick:E,className:L.fixedPosition,label:"Up"})]}):l.jsx("div",{className:h.error,children:"Camper not found"})}export{H as default};
