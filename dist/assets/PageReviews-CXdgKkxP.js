import{a as j,u as I,d as b,f as O,k as J,r as s,i as _,j as n,c as $,l as k,m as A}from"./index-D2inHSVb.js";import{u as B,S as L,s as P}from"./ScrollToTopButton-CiX1mJrd.js";import W from"./ContentReviews-BXweEmdq.js";import{u as q}from"./useTranslation-0psHgoRi.js";import"./Button-CZjkuQWG.js";import"./useForm-CQu2Tm2H.js";import"./v4-CmTdKEVZ.js";const z="_error_1m7va_2",u={"container-page":"_container-page_1m7va_1",error:z,"loader-container":"_loader-container_1m7va_17"};function V(){const{t:h}=q(),f=j(),w=I(),{_id:t}=b(),o=O(),c=J(),[i,m]=s.useState(null),[x,p]=s.useState(!1),[v,l]=s.useState(null),[y,g]=s.useState(0),[C,S]=s.useState([]),{visible:R,scrollToTop:N}=B(300);s.useEffect(()=>{window.scrollTo(0,0)},[o.pathname]),s.useEffect(()=>{async function a(){var e;if(c!=null&&c.camper)m(c.camper),localStorage.setItem(`camper_${t}`,JSON.stringify(c.camper));else if((e=o==null?void 0:o.state)!=null&&e.camper)m(o.state.camper),localStorage.setItem(`camper_${t}`,JSON.stringify(o.state.camper));else{const d=localStorage.getItem(`camper_${t}`);if(d)m(JSON.parse(d));else if(t)try{p(!0);const r=await k({id:t});(r==null?void 0:r.length)>0?(m(r[0]),localStorage.setItem(`camper_${t}`,JSON.stringify(r[0]))):l("Camper not found.")}catch(r){l(r.message||"Error loading camper.")}finally{p(!1)}else l("Camper ID not specified")}}a()},[t,c,o]),s.useEffect(()=>{if(i){const a=i.reviews||[];S(a),T(a),f(_(i))}},[i,f]);const T=a=>{if(!a||a.length===0){g(0);return}const e=a.reduce((d,r)=>d+r.reviewer_rating,0);g(e/a.length)},E=async a=>{try{p(!0),l(null);const e=await A({camperId:t,...a});e!=null&&e.camper?(m(e.camper),S(e.camper.reviews),g(e.camper.rating),f(_(e.camper)),localStorage.setItem(`camper_${t}`,JSON.stringify(e.camper)),w("/thank-you",{state:{camperId:t}})):l("Error adding review and updating data.")}catch(e){l(e.message||"Error sending feedback.")}finally{p(!1)}};return x?n.jsx("div",{className:u["loader-container"],children:n.jsx($,{type:"container"})}):v?n.jsxs("div",{className:u.error,children:["⚠️ Error: ",v]}):i?n.jsxs("div",{className:u["container-page"],children:[n.jsx(W,{camper:i,activeTab:"reviews",averageRating:y,reviews:C,onReviewAdded:E}),n.jsx(L,{visible:R,onClick:N,className:P["fixed-position"],label:h("up_button",{ns:"button"})})]}):n.jsx("div",{className:u.error,children:"⚠️ Camper not found"})}export{V as default};
