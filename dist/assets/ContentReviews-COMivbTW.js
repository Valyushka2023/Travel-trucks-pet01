import{r as j,P as i,j as e,u as q}from"./index-D5KXFkkO.js";import{c as b,B as S,H as L}from"./Button-C21Mqf4e.js";import{u as $,H,I as M,T as D}from"./useForm-Bn65brI-.js";import{v as z}from"./v4-CmTdKEVZ.js";const G=3;function K(r,c){const[s,u]=j.useState(1),p=j.useMemo(()=>r?[...r].sort((a,x)=>new Date(x.createdAt)-new Date(a.createdAt)):[],[r]),d=j.useMemo(()=>p.slice(0,s*G),[p,s]),_=d.length<p.length,l=()=>{u(a=>a+1)},o=()=>{u(1)};return j.useEffect(()=>{o()},[c]),{visibleReviews:d,hasMore:_,handleLoadMore:l,sortedReviews:p,resetPagination:o}}const V="_avatar_rydn7_1",U={avatar:V},T=({name:r})=>{const c=(r==null?void 0:r.charAt(0).toUpperCase())||"?";return e.jsx("div",{className:U.avatar,title:r,children:c})};T.propTypes={name:i.string.isRequired};const Y="_noReview_14j9q_1",J="_reviewContainer_14j9q_8",Q="_reviewHeader_14j9q_19",X="_reviewNameRating_14j9q_32",Z="_reviewerName_14j9q_41",O="_reviewRating_14j9q_51",ee="_filledStar_14j9q_56",re="_emptyStar_14j9q_61",te="_reviewDate_14j9q_66",ne="_reviewComment_14j9q_79",h={noReview:Y,reviewContainer:J,reviewHeader:Q,reviewNameRating:X,reviewerName:Z,reviewRating:O,filledStar:ee,emptyStar:re,reviewDate:te,reviewComment:ne};function C({review:r}){if(!r)return e.jsx("p",{className:h.noReview,children:"Review data is not available."});const c=r.reviewer_name||r["reviewer name"],s=r.review_text||r.comment,u=r.reviewer_rating??0,p=r.createdAt?new Date(r.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown date",d=_=>Array.from({length:5},(l,o)=>e.jsx("span",{className:o<_?h.filledStar:h.emptyStar,children:"★"},o));return e.jsxs("div",{className:h.reviewContainer,children:[e.jsxs("div",{className:h.reviewHeader,children:[e.jsx(T,{name:c}),e.jsxs("div",{className:h.reviewNameRating,children:[e.jsx("div",{className:h.reviewerName,children:c||"Anonymous"}),e.jsx("div",{className:h.reviewRating,children:d(u)})]}),e.jsx("div",{className:h.reviewDate,children:p})]}),(s==null?void 0:s.trim())&&e.jsx("div",{className:h.reviewComment,children:s})]})}C.propTypes={review:i.shape({reviewer_name:i.string,"reviewer name":i.string,review_text:i.string,comment:i.string,reviewer_rating:i.number,createdAt:i.string})};const ie="_reviewsList_4hhyz_1",se="_reviewItem_4hhyz_23",oe="_withBorder_4hhyz_31",A={reviewsList:ie,reviewItem:se,withBorder:oe},y=j.forwardRef(({reviews:r},c)=>e.jsx("ul",{className:A.reviewsList,children:r.map((s,u)=>{const p=u===r.length-1;return e.jsx("li",{className:`${A.reviewItem} ${p?"":A.withBorder}`,ref:p?c:null,children:e.jsx(C,{review:s})},s.id||s._id)})}));y.displayName="ReviewsList";y.propTypes={reviews:i.arrayOf(i.shape({id:i.string,_id:i.string,createdAt:i.string.isRequired,reviewer_name:i.string,comment:i.string,rating:i.number})).isRequired};const ae="_fieldForm_ax837_1",le="_label_ax837_25",ce="_inputAndErrorWrapper_ax837_39",me="_inputError_ax837_69",de="_stars_ax837_85",pe="_star_ax837_85",_e="_filled_ax837_121",ue="_empty_ax837_129",ve="_errorPopup_ax837_147",w={fieldForm:ae,label:le,inputAndErrorWrapper:ce,inputError:me,stars:de,star:pe,filled:_e,empty:ue,errorPopup:ve},F=({value:r,onChange:c,name:s="rating",totalStars:u=5,size:p=24,colorActive:d="#ffc107",colorInactive:_="#948f8fff",error:l,accessible:o=!0,readOnly:a=!1})=>{const x=v=>{!c||a||(v.key==="ArrowRight"&&r<u?c(r+1):v.key==="ArrowLeft"&&r>1&&c(r-1))};return e.jsxs("div",{className:w.fieldForm,children:[e.jsx("label",{htmlFor:s,className:w.label,children:"Rating*"}),e.jsxs("div",{id:s,className:b(w.inputAndErrorWrapper,{[w.inputError]:l}),role:o?"radiogroup":void 0,"aria-label":o?"Rating":void 0,tabIndex:o?0:void 0,onKeyDown:o?x:void 0,style:{"--active-star-color":d,"--inactive-star-color":_},children:[e.jsx("div",{className:w.stars,children:[...Array(u)].map((v,N)=>{const n=N+1;return e.jsx("span",{className:b(w.star,{[w.filled]:n<=r,[w.empty]:n>r}),style:{fontSize:`${p}px`,cursor:a?"default":"pointer"},role:o?"radio":void 0,"aria-checked":o?n===r:void 0,tabIndex:o?0:void 0,onClick:()=>{a||c(r===n?0:n)},onKeyDown:g=>{o&&(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),!a&&c(n))},children:"★"},n)})}),!a&&e.jsx("input",{type:"hidden",name:s,value:r}),l&&e.jsx("p",{className:w.errorPopup,children:l})]})]})};F.propTypes={value:i.number.isRequired,onChange:i.func,name:i.string,totalStars:i.number,size:i.number,colorActive:i.string,colorInactive:i.string,error:i.string,accessible:i.bool,readOnly:i.bool};const he="_form_iak0b_1",we="_titleForm_iak0b_17",xe="_textTitleForm_iak0b_24",ge="_textForm_iak0b_29",be="_inputsArea_iak0b_34",je="_inputs_iak0b_34",fe="_inputAndErrorWrapper_iak0b_47",Re="_fieldForm_iak0b_58",Ne="_ratingField_iak0b_70",Ae="_fieldArea_iak0b_81",ye="_commentAndCounterWrapper_iak0b_92",Se="_label_iak0b_99",Te="_labelComment_iak0b_106",Ce="_modalInput_iak0b_114",Fe="_modalTextArea_iak0b_115",ke="_elementSubmit_iak0b_167",Ee="_charCount_iak0b_173",We="_charCountWarning_iak0b_182",Pe="_errorPopup_iak0b_187",Ie="_generalErrorPopup_iak0b_188",Be="_inputError_iak0b_210",t={form:he,titleForm:we,textTitleForm:xe,textForm:ge,inputsArea:be,inputs:je,inputAndErrorWrapper:fe,fieldForm:Re,ratingField:Ne,fieldArea:Ae,commentAndCounterWrapper:ye,label:Se,labelComment:Te,modalInput:Ce,modalTextArea:Fe,elementSubmit:ke,charCount:Ee,charCountWarning:We,errorPopup:Pe,generalErrorPopup:Ie,inputError:Be},k=({camperId:r,onReviewAdded:c})=>{const s=q(),u={name:"",email:"",rating:0,comment:""},p={name:n=>n.trim()?n.length<2||n.length>20?"The name must be between 2 and 20 characters long.":null:"Please fill in this field.",email:n=>n.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?n.length>40?"Email is too long.":null:"Invalid email format.":"Please fill in this field.",rating:n=>n?null:"Please rate.",comment:n=>n.trim()?n.length>150?"The comment must contain up to 150 characters.":null:"Please fill in this field."},d=async n=>{console.log("1. onSubmit - Запущено функцію відправки.");const g={reviewer_name:n.name.trim(),reviewer_rating:parseInt(n.rating,10),comment:n.comment.trim(),email:n.email.trim(),id:z(),camperId:r,createdAt:new Date().toISOString()};try{console.log("2. onSubmit - Імітуємо затримку API-запиту..."),await new Promise(R=>setTimeout(R,300)),console.log("3. onSubmit - Імітація запиту завершена."),console.log("4. onSubmit - Викликаємо onReviewAdded..."),await c(g),console.log("5. onSubmit - onReviewAdded завершено. Дані відправлені:",g),console.log("6. onSubmit - Навігація до сторінки подяки..."),s("/thank-you")}catch(R){console.error("Помилка при відправці форми:",R)}},{formData:_,errors:l,isSubmitting:o,hasAttemptedSubmit:a,submissionError:x,handleInputChange:v,handleSubmit:N}=$(u,p,d);return console.log("Рендер FormReview - isSubmitting:",o,"hasAttemptedSubmit:",a),e.jsxs("form",{className:t.form,onSubmit:N,noValidate:!0,children:[e.jsxs("div",{className:t.titleForm,children:[e.jsx("h3",{className:t.textTitleForm,children:"Submit your review now"}),e.jsx("p",{className:t.textForm,children:"Stay connected! We are always ready to help you."})]}),e.jsx("div",{className:t.inputsArea,children:e.jsxs("div",{className:t.inputs,children:[e.jsxs("div",{className:t.fieldForm,children:[e.jsx("label",{htmlFor:"user-name-input",className:t.label,children:"Name*"}),e.jsxs("div",{className:t.inputAndErrorWrapper,children:[e.jsx("input",{id:"user-name-input",name:"name",type:"text",className:b(t.modalInput,{[t.inputError]:a&&l.name}),value:_.name,onChange:v,required:!0}),a&&l.name&&e.jsx("p",{className:t.errorPopup,children:l.name})]})]}),e.jsxs("div",{className:t.fieldForm,children:[e.jsx("label",{htmlFor:"user-email-input",className:t.label,children:"Email*"}),e.jsxs("div",{className:t.inputAndErrorWrapper,children:[e.jsx("input",{id:"user-email-input",name:"email",type:"email",className:b(t.modalInput,{[t.inputError]:a&&l.email}),value:_.email,onChange:v,required:!0}),a&&l.email&&e.jsx("p",{className:t.errorPopup,children:l.email})]})]}),e.jsx(F,{value:_.rating,onChange:n=>v({target:{name:"rating",value:n}}),name:"rating",error:a?l.rating:null,accessible:!0,className:t.ratingField}),e.jsxs("div",{className:t.fieldArea,children:[e.jsxs("div",{className:t.commentAndCounterWrapper,children:[e.jsx("label",{htmlFor:"user-comment",className:t.labelComment,children:"Comment*"}),e.jsxs("p",{className:b(t.charCount,{[t.charCountWarning]:_.comment.length>=150}),children:[_.comment.length," / 150"]})]}),e.jsxs("div",{className:b(t.inputAndErrorWrapper,t.commentInputWrapper),children:[e.jsx("textarea",{id:"user-comment",name:"comment",placeholder:"Your message",className:b(t.modalTextArea,{[t.inputError]:a&&l.comment}),value:_.comment,onChange:v,required:!0}),a&&l.comment&&e.jsx("p",{className:t.errorPopup,children:l.comment})]})]})]})}),e.jsxs("div",{className:t.elementSubmit,children:[e.jsx(S,{variant:"primary",size:"medium",type:"submit",disabled:o,children:o?"Sending...":"Submit"}),x&&e.jsx("p",{className:b(t.errorPopup,t.generalErrorPopup),children:x})]})]})};k.propTypes={camperId:i.string.isRequired,onReviewAdded:i.func.isRequired};const qe="_container_18r5l_1",Le="_containerContentReviews_18r5l_12",$e="_containerText_18r5l_18",He="_text_18r5l_24",Me="_listReviewsFormReview_18r5l_35",De="_listReviews_18r5l_35",ze="_containerFormReview_18r5l_47",Ge="_blokListButton_18r5l_61",Ke="_reviewsContentWrapper_18r5l_68",Ve="_containerButtons_18r5l_96",Ue="_buttonsWrapper_18r5l_105",Ye="_loadMoreWrapper_18r5l_112",Je="_loadMoreBtn_18r5l_121",Qe="_noReviews_18r5l_126",Xe="_scrollToTopBtn_18r5l_133",Ze="_visible_18r5l_170",Oe="_triangle_18r5l_175",m={container:qe,containerContentReviews:Le,containerText:$e,text:He,listReviewsFormReview:Me,listReviews:De,containerFormReview:ze,blokListButton:Ge,reviewsContentWrapper:Ke,containerButtons:Ve,buttonsWrapper:Ue,loadMoreWrapper:Ye,loadMoreBtn:Je,noReviews:Qe,scrollToTopBtn:Xe,visible:Ze,triangle:Oe};function ir({camper:r,activeTab:c,reviews:s,onReviewAdded:u}){const p=r._id||r.id,d=j.useRef(null),_=j.useRef(null),{visibleReviews:l,hasMore:o,handleLoadMore:a,sortedReviews:x,resetPagination:v}=K(s,p),[N,n]=j.useState(!1),g=()=>{setTimeout(()=>{d.current&&_.current&&_.current.offsetTop>d.current.offsetHeight&&d.current.scrollTo({top:d.current.scrollHeight,behavior:"smooth"})},100)},R=[m.blokReviewsForm];x.length>3&&R.push(m.blokReviewsFormScrollable);const E=f=>{u(f),g()},W=()=>{const f=d.current;if(f){const I=f.scrollHeight;a(),setTimeout(()=>{const B=f.scrollHeight;f.scrollTo({top:f.scrollTop+(B-I),behavior:"smooth"}),n(!0)},100)}},P=()=>{d.current&&(d.current.scrollTo({top:0,behavior:"smooth"}),n(!1),v())};return e.jsxs("div",{className:m.container,children:[e.jsx(L,{}),e.jsxs("div",{className:m.containerContentReviews,children:[e.jsx(H,{camper:r}),e.jsx(M,{gallery:r.gallery}),e.jsx("div",{className:m.containerText,children:e.jsx("p",{className:m.text,children:r.description})}),e.jsx(D,{camper:r,activeTab:c}),e.jsxs("div",{className:m.listReviewsFormReview,children:[e.jsx("div",{className:m.listReviews,children:e.jsx("div",{className:R.join(" "),children:s&&s.length>0?e.jsxs("div",{className:m.blokListButton,children:[e.jsx("div",{className:m.reviewsContentWrapper,ref:d,children:e.jsx(y,{reviews:l,ref:_})}),o&&e.jsx("div",{className:m.buttonsWrapper,children:e.jsx(S,{variant:"primary",size:"medium",onClick:W,className:m.loadMoreBtn,children:"Load more"})}),N&&e.jsx("div",{className:m.buttonsWrapper,children:e.jsx("div",{onClick:P,className:`${m.scrollToTopBtn} ${m.visible}`,children:e.jsx("div",{className:m.triangle})})})]}):e.jsx("p",{className:m.noReviews,children:"No reviews yet"})})}),e.jsx("div",{className:m.containerFormReview,children:e.jsx(k,{camperId:p,onReviewAdded:E})})]})]})]})}export{ir as default};
