import{a as E,u as I,c as T,e as O,i as b,r as s,h as C,j as o,k as B,l as J}from"./index-DOgmcHEW.js";import{u as $,C as k,S as A,s as L}from"./ClipLoader-CNYowGEs.js";import P from"./ContentReviews-w6SPF2ad.js";import"./Button-Brp1NMXi.js";import"./useForm-DqXGaXuL.js";import"./v4-CmTdKEVZ.js";const z="_loaderContainer_9fnp6_1",g={loaderContainer:z};function H(){const u=E(),h=I(),{_id:t}=T(),n=O(),i=b(),[c,m]=s.useState(null),[w,p]=s.useState(!1),[v,l]=s.useState(null),[x,f]=s.useState(0),[R,S]=s.useState([]),{visible:y,scrollToTop:N}=$(300);s.useEffect(()=>{async function a(){var e;if(i!=null&&i.camper)m(i.camper),localStorage.setItem(`camper_${t}`,JSON.stringify(i.camper));else if((e=n==null?void 0:n.state)!=null&&e.camper)m(n.state.camper),localStorage.setItem(`camper_${t}`,JSON.stringify(n.state.camper));else{const d=localStorage.getItem(`camper_${t}`);if(d)m(JSON.parse(d));else if(t)try{p(!0);const r=await B({id:t});(r==null?void 0:r.length)>0?(m(r[0]),localStorage.setItem(`camper_${t}`,JSON.stringify(r[0]))):l("Camper not found.")}catch(r){l(r.message||"Error loading camper.")}finally{p(!1)}else l("Camper ID не вказаний.")}}a()},[t,i,n]),s.useEffect(()=>{if(c){const a=c.reviews||[];S(a),_(a),u(C(c))}},[c,u]);const _=a=>{if(!a||a.length===0){f(0);return}const e=a.reduce((d,r)=>d+r.reviewer_rating,0);f(e/a.length)},j=async a=>{try{p(!0),l(null);const e=await J({camperId:t,...a});e!=null&&e.camper?(m(e.camper),S(e.camper.reviews),f(e.camper.rating),u(C(e.camper)),localStorage.setItem(`camper_${t}`,JSON.stringify(e.camper)),h("/thank-you",{state:{camperId:t}})):l("Error adding review and updating data.")}catch(e){l(e.message||"Error sending feedback.")}finally{p(!1)}};return w?o.jsx("div",{className:g.loaderContainer,children:o.jsx(k,{color:"#36D7B7",size:50})}):v?o.jsxs("div",{className:g.error,children:["Error: ",v]}):c?o.jsxs("div",{children:[o.jsx(P,{camper:c,activeTab:"reviews",averageRating:x,reviews:R,onReviewAdded:j}),o.jsx(A,{visible:y,onClick:N,className:L.fixedPosition,label:"Up"})]}):o.jsx("div",{className:g.error,children:"Camper not found"})}export{H as default};
